/**
 * Created by kasperpeulen on 23/09/14.
 */


var tex2unicode = {
    "Î±" : "\\alpha",
    "Î²" : "\\beta" ,
    "\u2071": "^i",
    "\u2074": "^4",
    "\u2075": "^5",
    "\u2076": "^6",
    "\u2077": "^7",
    "\u2078": "^8",
    "\u2079": "^9",
    "\u207A": "^+",
    "\u207B": "^-",
    "\u207C": "^=",
    "\u207D": "^(",
    "\u207E": "^)",
    "\u207F": "^n",
    "\u2080": "_0",
    "\u2081": "_1",
    "\u2082": "_2",
    "\u2083": "_3",
    "\u2084": "_4",
    "\u2085": "_5",
    "\u2086": "_6",
    "\u2087": "_7",
    "\u2088": "_8",
    "\u2089": "_9",
    "\u208A": "_+",
    "\u208B": "_-",
    "\u208C": "_=",
    "\u208D": "_(",
    "\u208E": "_)",
    "\u03B1": "\\alpha ",
    "\u03B2": "\\beta ",
    "\u03B3": "\\gamma ",
    "\u03B4": "\\delta ",
    "\u03B5": "\\epsilon ",
    "\u03B6": "\\zeta ",
    "\u03B7": "\\eta ",
    "\u03B8": "\\texttheta ",
    "\u03B9": "\\iota ",
    "\u03BA": "\\kappa ",
    "\u03BB": "\\lambda ",
    "\u03BC": "\\mu ",
    "\u03BD": "\\nu ",
    "\u03BE": "\\xi ",
    "\u03C0": "\\pi ",
    "\u03C1": "\\rho ",
    "\u03C2": "\\varsigma ",
    "\u03C3": "\\sigma ",
    "\u03C4": "\\tau ",
    "\u03C5": "\\upsilon ",
    "\u03C6": "\\varphi ",
    "\u03C7": "\\chi ",
    "\u03C8": "\\psi ",
    "\u03C9": "\\omega ",
    "\u03D5": "\\phi ",
    "\u03D6": "\\varpi ",
    "\u03DA": "\\Stigma ",
    "\u03DC": "\\Digamma ",
    "\u03DD": "\\digamma ",
    "\u03DE": "\\Koppa ",
    "\u03E0": "\\Sampi ",
    "\u03F0": "\\varkappa ",
    "\u03F1": "\\varrho ",
    "ğ”„": "\\mathfrak{A}",
    "ğ”…": "\\mathfrak{B}",
    "â„­": "\\mathfrak{C}",
    "ğ”‡": "\\mathfrak{D}",
    "ğ”ˆ": "\\mathfrak{E}",
    "ğ”‰": "\\mathfrak{F}",
    "ğ”Š": "\\mathfrak{G}",
    "â„Œ": "\\mathfrak{H}",
    "â„‘": "\\mathfrak{I}",
    "ğ”": "\\mathfrak{J}",
    "ğ”": "\\mathfrak{K}",
    "ğ”": "\\mathfrak{L}",
    "ğ”": "\\mathfrak{M}",
    "ğ”‘": "\\mathfrak{N}",
    "ğ”’": "\\mathfrak{O}",
    "ğ”“": "\\mathfrak{P}",
    "ğ””": "\\mathfrak{Q}",
    "â„œ": "\\mathfrak{R}",
    "ğ”–": "\\mathfrak{S}",
    "ğ”—": "\\mathfrak{T}",
    "ğ”˜": "\\mathfrak{U}",
    "ğ”™": "\\mathfrak{V}",
    "ğ”š": "\\mathfrak{W}",
    "ğ”›": "\\mathfrak{X}",
    "ğ”œ": "\\mathfrak{Y}",
    "â„¨": "\\mathfrak{Z}",
    "ğ”": "\\mathfrak{a}",
    "ğ”Ÿ": "\\mathfrak{b}",
    "ğ” ": "\\mathfrak{c}",
    "ğ”¡": "\\mathfrak{d}",
    "ğ”¢": "\\mathfrak{e}",
    "ğ”£": "\\mathfrak{f}",
    "ğ”¤": "\\mathfrak{g}",
    "ğ”¥": "\\mathfrak{h}",
    "ğ”¦": "\\mathfrak{i}",
    "ğ”§": "\\mathfrak{j}",
    "ğ”¨": "\\mathfrak{k}",
    "ğ”©": "\\mathfrak{l}",
    "ğ”ª": "\\mathfrak{m}",
    "ğ”«": "\\mathfrak{n}",
    "ğ”¬": "\\mathfrak{o}",
    "ğ”­": "\\mathfrak{p}",
    "ğ”®": "\\mathfrak{q}",
    "ğ”¯": "\\mathfrak{r}",
    "ğ”°": "\\mathfrak{s}",
    "ğ”±": "\\mathfrak{t}",
    "ğ”²": "\\mathfrak{u}",
    "ğ”³": "\\mathfrak{v}",
    "ğ”´": "\\mathfrak{w}",
    "ğ”µ": "\\mathfrak{x}",
    "ğ”¶": "\\mathfrak{y}",
    "ğ”·": "\\mathfrak{z}",
    "ğ’œ": "\\mathcal{A}",
    "â„¬": "\\mathcal{B}",
    "ğ’": "\\mathcal{C}",
    "ğ’Ÿ": "\\mathcal{D}",
    "â„°": "\\mathcal{E}",
    "â„±": "\\mathcal{F}",
    "ğ’¢": "\\mathcal{G}",
    "â„‹": "\\mathcal{H}",
    "â„": "\\mathcal{I}",
    "ğ’¥": "\\mathcal{J}",
    "ğ’¦": "\\mathcal{K}",
    "â„’": "\\mathcal{L}",
    "â„³": "\\mathcal{M}",
    "ğ’©": "\\mathcal{N}",
    "ğ’ª": "\\mathcal{O}",
    "ğ’«": "\\mathcal{P}",
    "ğ’¬": "\\mathcal{Q}",
    "â„›": "\\mathcal{R}",
    "ğ’®": "\\mathcal{S}",
    "ğ’¯": "\\mathcal{T}",
    "ğ’°": "\\mathcal{U}",
    "ğ’±": "\\mathcal{V}",
    "ğ’²": "\\mathcal{W}",
    "ğ’³": "\\mathcal{X}",
    "ğ’´": "\\mathcal{Y}",
    "ğ’µ": "\\mathcal{Z}",
    "â…" : "\\(",
    "â†" : "\\)",
    // "âˆ•": "\\over ",
    "Â¦": "\\choose ",
    'â´': "\\{",
    'âµ': "\\}",
    'ô€€¢' :'\\big(',
    'ô€€£' :'\\Big(',
    'ô€€¤' : '\\bigg(',
    'ô€€¥' : '\\Bigg(',
    'ô€€©' : '\\big)',
    'ô€€ª' : '\\Big)',
    'ô€€«' : '\\bigg)',
    'ô€€¬' : '\\Bigg)',
    'ô€€‘' :'\\big[',
    'ô€€’' :'\\Big[',
    'ô€€“' : '\\bigg[',
    'ô€€”' : '\\Bigg[',
    'ô€€˜' : '\\big]',
    'ô€€™' : '\\Big]',
    'ô€€š' : '\\bigg]',
    'ô€€›' : '\\Bigg]',
    'ô€€' :'\\big\\{',
    'ô€€‚' :'\\Big\\{',
    'ô€€ƒ' : '\\bigg\\{',
    'ô€€„' : '\\Bigg\\{',
    'ô€€ˆ' : '\\big\\}',
    'ô€€‰' : '\\Big\\}',
    'ô€€Š' : '\\bigg\\}',
    'ô€€‹' : '\\Bigg\\}',
    'â™¡' : '\\heartsuit',
    "â‰": "\\stackrel{\\small\\text{def}}{=}",
    'â‰': "\\stackrel{\\text{m}}{=}",
    'â‰Ÿ': "\\stackrel{\\text{?}}{=}",
    'â…€': '\\Bbb{\\Sigma}',
    'â€¾': '\\overline',
    'â–': '\\underline',
    'â': '\\overbrace ',
    '\u23DF': '\\underbrace',
    'â¨€': '\\bigodot ',
    "\u2102": "\\Bbb{C}",
    "\u210A": "\\mathcal{g}",
    "\u210D": "\\Bbb{H}",
    "\u210F": "\\hslash ",
    "\u2113": "\\ell ",
    "\u2115": "\\Bbb{N}",
    "\u2116": "\\cyrchar\\textnumero ",
    "\u2118": "\\wp ",
    "\u2119": "\\Bbb{P}",
    "\u211A": "\\Bbb{Q}",
    "\u211D": "\\Bbb{R}",
    "\u211E": "\\Elzxrat ",
    "\u2122": "\\texttrademark ",
    "\u2124": "\\Bbb{Z}",
    "\u2126": "\\Omega ",
    "\u2127": "\\mho ",
    "\u2129": "\\ElsevierGlyph{2129}",
    "\u212B": "\\AA ",
    "\u212F": "\\mathcal{e}",
    "\u2134": "\\mathcal{o}",
    "\uD504": "\\mathfrak{A}",
    "\uD505": "\\mathfrak{B}",
    "\uD507": "\\mathfrak{D}",
    "\uD508": "\\mathfrak{E}",
    "\uD509": "\\mathfrak{F}",
    "\uD50A": "\\mathfrak{G}",
    "\uD50D": "\\mathfrak{J}",
    "\uD50E": "\\mathfrak{K}",
    "\uD50F": "\\mathfrak{L}",
    "\uD510": "\\mathfrak{M}",
    "\uD511": "\\mathfrak{N}",
    "\uD512": "\\mathfrak{O}",
    "\uD513": "\\mathfrak{P}",
    "\uD514": "\\mathfrak{Q}",
    "\uD516": "\\mathfrak{S}",
    "\uD517": "\\mathfrak{T}",
    "\uD518": "\\mathfrak{U}",
    "\uD519": "\\mathfrak{V}",
    "\uD51A": "\\mathfrak{W}",
    "\uD51B": "\\mathfrak{X}",
    "\uD51C": "\\mathfrak{Y}",
    "\uD51E": "\\mathfrak{a}",
    "\uD51F": "\\mathfrak{b}",
    "\uD520": "\\mathfrak{c}",
    "\uD521": "\\mathfrak{d}",
    "\uD522": "\\mathfrak{e}",
    "\uD523": "\\mathfrak{f}",
    "\uD524": "\\mathfrak{g}",
    "\uD525": "\\mathfrak{h}",
    "\uD526": "\\mathfrak{i}",
    "\uD527": "\\mathfrak{j}",
    "\uD528": "\\mathfrak{k}",
    "\uD529": "\\mathfrak{l}",
    "\uD52A": "\\mathfrak{m}",
    "\uD52B": "\\mathfrak{n}",
    "\uD52C": "\\mathfrak{o}",
    "\uD52D": "\\mathfrak{p}",
    "\uD52E": "\\mathfrak{q}",
    "\uD52F": "\\mathfrak{r}",
    "\uD530": "\\mathfrak{s}",
    "\uD531": "\\mathfrak{t}",
    "\uD532": "\\mathfrak{u}",
    "\uD533": "\\mathfrak{v}",
    "\uD534": "\\mathfrak{w}",
    "\uD535": "\\mathfrak{x}",
    "\uD536": "\\mathfrak{y}",
    "\uD537": "\\mathfrak{z}",
    "\uD538": "\\Bbb{A}",
    "\uD539": "\\Bbb{B}",
    "\uD53B": "\\Bbb{D}",
    "\uD53C": "\\Bbb{E}",
    "\uD53D": "\\Bbb{F}",
    "\uD53E": "\\Bbb{G}",
    "\uD540": "\\Bbb{I}",
    "\uD541": "\\Bbb{J}",
    "\uD542": "\\Bbb{K}",
    "\uD543": "\\Bbb{L}",
    "\uD544": "\\Bbb{M}",
    "\uD546": "\\Bbb{O}",
    "\uD54A": "\\Bbb{S}",
    "\uD54B": "\\Bbb{T}",
    "\uD54C": "\\Bbb{U}",
    "\uD54D": "\\Bbb{V}",
    "\uD54E": "\\Bbb{W}",
    "\uD54F": "\\Bbb{X}",
    "\uD550": "\\Bbb{Y}",
    "\uD552": "\\Bbb{a}",
    "\uD553": "\\Bbb{b}",
    "\uD554": "\\Bbb{c}",
    "\uD555": "\\Bbb{d}",
    "\uD556": "\\Bbb{e}",
    "\uD557": "\\Bbb{f}",
    "\uD558": "\\Bbb{g}",
    "\uD559": "\\Bbb{h}",
    "\uD55A": "\\Bbb{i}",
    "\uD55B": "\\Bbb{j}",
    "\uD55C": "\\Bbb{k}",
    "\uD55D": "\\Bbb{l}",
    "\uD55E": "\\Bbb{m}",
    "\uD55F": "\\Bbb{n}",
    "\uD560": "\\Bbb{o}",
    "\uD561": "\\Bbb{p}",
    "\uD562": "\\Bbb{q}",
    "\uD563": "\\Bbb{r}",
    "\uD564": "\\Bbb{s}",
    "\uD565": "\\Bbb{t}",
    "\uD566": "\\Bbb{u}",
    "\uD567": "\\Bbb{v}",
    "\uD568": "\\Bbb{w}",
    "\uD569": "\\Bbb{x}",
    "\uD56A": "\\Bbb{y}",
    "\uD56B": "\\Bbb{z}"
}

var tex_to_ctex = function () {
    var textarea = $(activeElement).val();
    var caret = getCaretPosition(activeElement);
    var oldlength = textarea.length;
    for (var b in unicode_to_latex) {
        var a = unicode_to_latex[b];

        a = a.replace(/[-\/\\^$*+?.()|[\]{}]/g, '\\$&');
        if (a == "\\\\bar"){console.log(a,b);}
        if (/[\u0300-\u036e\u1dc0-\u1dfe\u20d0-\u20fe\ufe20-\ufe2e]/.test(b)) {
            console.log("1");
            var re = new RegExp("(" + a + "){(\\w)}", "g");
            textarea = textarea.replace(re, "$2"+b);
        }
        else{
        var re = new RegExp("(" + a + ")", "g");
        textarea = textarea.replace(re, b);
        }
    }
    var newlength = textarea.length;
    console.log(caret, oldlength, newlength);
    $('#ta').val(textarea);
    if (newlength !== oldlength) {
        setCaretPosition(activeElement, caret + newlength - oldlength);
    }
}